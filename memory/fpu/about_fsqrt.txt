fsqrtの実装について


紙資料の方では[1.0,4.0)の区間を1024等分して各区間における近似直線を
計算し、傾きと切片をROMから引き出して近似値を算出するようになっている。

インデックスの計算は指数部下1桁と仮数部上9桁の合わせて10桁を用いる
ようになっているが、単純に組み合わせるだけだと正しいインデックスにならない
感じがする。

実際にインデックスを求める際には入力xを[1.0,4.0)の範囲に正規化したx'を用いて
floor{(x' - 1) * 1024 / 3}
として計算しなければならないはずだが、3で割るという操作が入るため、
単純に指数部や仮数部の一部を切り出しただけだと計算できそうにない。

そこで、本実装では[1.0,2,0)の区間を512等分、[2.0,4.0)の区間を1024等分して
それぞれの傾きa1, a2と切片b1, b2を4つのROMから引き出して計算するようにした。

近似値の計算の際には以下のようなステップを踏むことになる。
1.
仮数部の上9桁をインデックスとしてa1, b1を 引き出し、
仮数部の上10桁をインデックスとしてa2, b2を引き出しておく。

2.
指数部の下1桁が1(つまり[1.0,2.0))であればa = a1, b = b1とし、
0(つまり[2.0,4.0)であればa = a2, b = b2とする。

3.
a * x' + bとして近似値を計算する。

指数部の計算などその他の部分は紙資料と同じ作り方になっている。
